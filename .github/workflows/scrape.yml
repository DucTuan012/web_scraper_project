# .github/workflows/scrape.yml

# TÃªn cá»§a workflow, báº¡n cÃ³ thá»ƒ Ä‘áº·t báº¥t cá»© tÃªn gÃ¬
name: ğŸ Check Gold Price

on:
  # Cho phÃ©p báº¡n cháº¡y thá»§ cÃ´ng tá»« tab "Actions" trÃªn GitHub
  workflow_dispatch:
  
  # Lá»‹ch cháº¡y tá»± Ä‘á»™ng
  schedule:
    # Cáº¥u hÃ¬nh CRON: Cháº¡y vÃ o phÃºt thá»© 0 cá»§a má»—i giá»
    # (vÃ­ dá»¥: 8:00, 9:00, 10:00)
    # Äá»ƒ test nhanh, báº¡n cÃ³ thá»ƒ Ä‘á»•i thÃ nh '*/5 * * * *' (má»—i 5 phÃºt)
    - cron: '0 * * * *'

jobs:
  scrape:
    # Cháº¡y trÃªn mÃ¡y áº£o Ubuntu
    runs-on: ubuntu-latest

    steps:
      # BÆ°á»›c 1: Táº£i code tá»« kho chá»©a cá»§a báº¡n vá» mÃ¡y áº£o
      - name: 1. Check out repository
        uses: actions/checkout@v4

      # BÆ°á»›c 2: CÃ i Ä‘áº·t phiÃªn báº£n Python 3.10
      - name: 2. Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # BÆ°á»›c 3: CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n tá»« file requirements.txt
      - name: 3. Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # BÆ°á»›c 4: Cháº¡y script Python
      - name: 4. Run scraper
        run: python scrape_gold.py

      # BÆ°á»›c 5: Tá»± Ä‘á»™ng commit file gold_price.json Ä‘Ã£ bá»‹ thay Ä‘á»•i
      # ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng Ä‘á»ƒ "lÆ°u" giÃ¡ má»›i cho láº§n cháº¡y sau
      - name: 5. Commit and push if data changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Tin nháº¯n commit
          commit_message: 'Update gold price data'
          # Chá»‰ commit file nÃ y
          file_pattern: 'gold_price.json'
